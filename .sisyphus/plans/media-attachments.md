# –ú–µ–¥–∏–∞/–í–ª–æ–∂–µ–Ω–∏—è ‚Äî –î–∏–∑–∞–π–Ω-–¥–æ–∫—É–º–µ–Ω—Ç

> **–°—Ç–∞—Ç—É—Å**: –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (–±–µ–∑ –∫–æ–¥–∞)  
> **–î–∞—Ç–∞**: 2026-02-11

---

## –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### –ß—Ç–æ —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (–±—ç–∫–µ–Ω–¥)

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –§–∞–π–ª | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç |
|-----------|------|------------|
| –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏–∑ Telegram | `src/bot/handlers/media.ts` | photo, document, voice ‚Äî —Å–∫–∞—á–∏–≤–∞–µ—Ç, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–∞ –¥–∏—Å–∫ |
| –¢–∞–±–ª–∏—Ü–∞ `media` | `src/db/schema.sql:96-122` | id, task_id, type, file_path, mime_type, transcription –∏ —Ç.–¥. |
| CRUD | `src/db/media.ts` | createMedia, getMedia, getMediaForTask, updateMedia, deleteMediaForTask |
| –û—Ç–¥–∞—á–∞ —Ñ–∞–π–ª–æ–≤ | `GET /files/:mediaId` | –°—Ç—Ä–∏–º + –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞ |
| Capture-–ª–æ–≥–∏–∫–∞ | `src/lib/capture.ts` | –ú–µ–¥–∏–∞ ‚Üí –ø–∞–ø–∫–∞ `media` –∞–≤—Ç–æ–º–∞—Ç–æ–º |
| –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –≥–æ–ª–æ—Å–∞ | `media_queue` | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—á–µ—Ä–µ–¥—å + Whisper (–≥–æ–ª–æ—Å ‚Üí —Ç–µ–∫—Å—Ç) |

### –ß—Ç–æ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç / –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

| –ü—Ä–æ–±–ª–µ–º–∞ | –ì–¥–µ |
|----------|-----|
| **–ê–ª—å–±–æ–º—ã –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç —Ñ–∞–π–ª—ã** | `processMediaGroup()` —Å–æ–∑–¥–∞—ë—Ç –∑–∞–¥–∞—á—É, –Ω–æ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç `processMediaMessage()` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–æ—Ç–æ |
| **–ù–µ—Ç API "–º–µ–¥–∏–∞ –∑–∞–¥–∞—á–∏"** | –ù–µ—Ç `GET /tasks/:id/media` ‚Äî —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–µ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –≤–ª–æ–∂–µ–Ω–∏—è |
| **–ù–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ Mini App** | –ù–µ—Ç `POST /tasks/:id/media` ‚Äî —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –±–æ—Ç–∞ |
| **–ù–µ—Ç —É–¥–∞–ª–µ–Ω–∏—è –º–µ–¥–∏–∞** | –ù–µ—Ç `DELETE /media/:id` |
| **–§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø—É—Å—Ç** | Task —Ç–∏–ø –±–µ–∑ –º–µ–¥–∏–∞-–ø–æ–ª–µ–π, –∑–∞–≥–ª—É—à–∫–∞ –≤ TaskDetailSheet, –Ω–µ—Ç üìé –≤ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö |
| **–í–∏–¥–µ–æ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è** | –ù–∞–º–µ—Ä–µ–Ω–Ω–æ ‚Äî –Ω–µ –Ω—É–∂–Ω–æ –≤ MVP |
| **–§–∞–π–ª-–Ω–µ–π–º–∏–Ω–≥: 1 —Ñ–∞–π–ª = 1 –∑–∞–¥–∞—á–∞** | `saveFile()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `{taskId}.{ext}` ‚Äî –ø—Ä–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–∞–π–ª–∞—Ö –Ω–∞ –∑–∞–¥–∞—á—É –±—É–¥—É—Ç –∫–æ–ª–ª–∏–∑–∏–∏ –∏–º—ë–Ω |

---

## –ü—Ä–∏–Ω—è—Ç—ã–µ —Ä–µ—à–µ–Ω–∏—è

| –†–µ—à–µ–Ω–∏–µ | –í—ã–±–æ—Ä | –ü–æ—á–µ–º—É |
|---------|-------|--------|
| –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ Mini App | ‚úÖ –î–∞ | –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –æ–ø—ã—Ç, –Ω–µ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –±–æ—Ç |
| –ù–µ—Å–∫–æ–ª—å–∫–æ –≤–ª–æ–∂–µ–Ω–∏–π –Ω–∞ –∑–∞–¥–∞—á—É | ‚úÖ –î–∞ | –ê–ª—å–±–æ–º—ã –∏–∑ –±–æ—Ç–∞, –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤ –∏–∑ Mini App |
| –í–∏–¥–µ–æ | ‚ùå –ù–µ—Ç | –°–ª–∏—à–∫–æ–º —Ç—è–∂–µ–ª–æ –¥–ª—è MVP, –Ω–µ—Ç use case |
| –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö | üìé –∏–∫–æ–Ω–∫–∞ | –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ, –±–µ–∑ –º–∏–Ω–∏–∞—Ç—é—Ä |
| –ì–æ–ª–æ—Å–æ–≤—ã–µ | –¢–æ–ª—å–∫–æ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è | –ë–µ–∑ –∞—É–¥–∏–æ–ø–ª–µ–µ—Ä–∞, –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–µ–∫—Å—Ç |

---

## –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π A: –§–æ—Ç–æ —á–µ—Ä–µ–∑ –±–æ—Ç–∞
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–æ—Ç–æ (—Å –ø–æ–¥–ø–∏—Å—å—é –∏–ª–∏ –±–µ–∑) –≤ –±–æ—Ç
2. –ë–æ—Ç —Å–æ–∑–¥–∞—ë—Ç –∑–∞–¥–∞—á—É, —Å–∫–∞—á–∏–≤–∞–µ—Ç —Ñ–æ—Ç–æ, —Å–æ–∑–¥–∞—ë—Ç `media` –∑–∞–ø–∏—Å—å
3. –í Mini App –≤ —Å–ø–∏—Å–∫–µ –∑–∞–¥–∞—á ‚Äî üìé —Ä—è–¥–æ–º —Å —Ç–µ–∫—Å—Ç–æ–º
4. –ù–∞–∂–∞—Ç–∏–µ ‚Üí TaskDetailSheet ‚Üí —Å–µ–∫—Ü–∏—è "–í–ª–æ–∂–µ–Ω–∏—è" ‚Üí –ø—Ä–µ–≤—å—é —Ñ–æ—Ç–æ
5. –ù–∞–∂–∞—Ç–∏–µ –Ω–∞ —Ñ–æ—Ç–æ ‚Üí –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä (–Ω–∞—Ç–∏–≤–Ω—ã–π, —á–µ—Ä–µ–∑ `openLink` –∏–ª–∏ `window.open`)

### –°—Ü–µ–Ω–∞—Ä–∏–π B: –î–æ–∫—É–º–µ–Ω—Ç —á–µ—Ä–µ–∑ –±–æ—Ç–∞
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç PDF/—Ñ–∞–π–ª –≤ –±–æ—Ç
2. –ë–æ—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç, —Å–æ–∑–¥–∞—ë—Ç `media` —Å `originalFilename`
3. –í TaskDetailSheet ‚Äî –∏–∫–æ–Ω–∫–∞ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞ + –∏–º—è —Ñ–∞–π–ª–∞
4. –ù–∞–∂–∞—Ç–∏–µ ‚Üí —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `/files/:mediaId`

### –°—Ü–µ–Ω–∞—Ä–∏–π C: –ê–ª—å–±–æ–º —á–µ—Ä–µ–∑ –±–æ—Ç–∞
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 3 —Ñ–æ—Ç–æ –∫–∞–∫ –∞–ª—å–±–æ–º
2. –ë–æ—Ç —Å–æ–∑–¥–∞—ë—Ç 1 –∑–∞–¥–∞—á—É, —Å–∫–∞—á–∏–≤–∞–µ—Ç **–≤—Å–µ 3 —Ñ–æ—Ç–æ**, —Å–æ–∑–¥–∞—ë—Ç 3 –∑–∞–ø–∏—Å–∏ `media`
3. TaskDetailSheet ‚Äî –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ª–µ–Ω—Ç–∞ –ø—Ä–µ–≤—å—é
4. üìé 3 –≤ –∫–∞—Ä—Ç–æ—á–∫–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π D: –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ Mini App
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç TaskDetailSheet ‚Üí –Ω–∞–∂–∏–º–∞–µ—Ç "–î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª"
2. –ù–∞—Ç–∏–≤–Ω—ã–π —Ñ–∞–π–ª-–ø–∏–∫–µ—Ä ‚Üí –≤—ã–±–∏—Ä–∞–µ—Ç —Ñ–æ—Ç–æ/–¥–æ–∫—É–º–µ–Ω—Ç
3. –§–∞–π–ª –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `POST /tasks/:id/media` (FormData)
4. –°–µ–∫—Ü–∏—è "–í–ª–æ–∂–µ–Ω–∏—è" –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è ‚Äî –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø—Ä–µ–≤—å—é

### –°—Ü–µ–Ω–∞—Ä–∏–π E: –ì–æ–ª–æ—Å–æ–≤–æ–µ —á–µ—Ä–µ–∑ –±–æ—Ç–∞
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
2. –ë–æ—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç .ogg, —Å—Ç–∞–≤–∏—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é –≤ –æ—á–µ—Ä–µ–¥—å
3. –ó–∞–¥–∞—á–∞: —Å–Ω–∞—á–∞–ª–∞ "–ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ", –ø–æ—Ç–æ–º –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫—É
4. TaskDetailSheet: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ (–±–µ–∑ –ø–ª–µ–µ—Ä–∞)
5. –ï—Å–ª–∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è pending ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å "–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞..."

### –°—Ü–µ–Ω–∞—Ä–∏–π F: –£–¥–∞–ª–µ–Ω–∏–µ –≤–ª–æ–∂–µ–Ω–∏—è
1. –í TaskDetailSheet ‚Üí —Å–µ–∫—Ü–∏—è "–í–ª–æ–∂–µ–Ω–∏—è" ‚Üí —Å–≤–∞–π–ø –≤–ª–µ–≤–æ / –∫–Ω–æ–ø–∫–∞ üóë
2. `DELETE /media/:id` ‚Üí —Ñ–∞–π–ª —É–¥–∞–ª—è–µ—Ç—Å—è —Å –¥–∏—Å–∫–∞, –∑–∞–ø–∏—Å—å –∏–∑ –ë–î
3. –ï—Å–ª–∏ –≤–ª–æ–∂–µ–Ω–∏–π –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å ‚Äî —Å–µ–∫—Ü–∏—è "–í–ª–æ–∂–µ–Ω–∏—è" —Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è, üìé –ø—Ä–æ–ø–∞–¥–∞–µ—Ç

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±—ç–∫–µ–Ω–¥–µ

#### 1. –§–∏–∫—Å –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤
**–ü—Ä–æ–±–ª–µ–º–∞**: `saveFile()` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–∞–∫ `{taskId}.{ext}` ‚Äî –ø—Ä–∏ –≤—Ç–æ—Ä–æ–º —Ñ–∞–π–ª–µ –ø–µ—Ä–µ–∑–∞–ø–∏—à–µ—Ç –ø–µ—Ä–≤—ã–π.

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `{mediaId}.{ext}` –≤–º–µ—Å—Ç–æ `{taskId}.{ext}`. `mediaId` —É–Ω–∏–∫–∞–ª–µ–Ω.

**–§–∞–π–ª**: `src/bot/handlers/media.ts:30-44`

#### 2. –§–∏–∫—Å –∞–ª—å–±–æ–º–æ–≤
**–ü—Ä–æ–±–ª–µ–º–∞**: `processMediaGroup()` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç `processMediaMessage()` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è.

**–†–µ—à–µ–Ω–∏–µ**: –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏, –≤ —Ü–∏–∫–ª–µ –≤—ã–∑–≤–∞—Ç—å `processMediaMessage(task.id, msg)` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø–µ.

**–§–∞–π–ª**: `src/bot/handlers/message.ts:217-261`

#### 3. –ù–æ–≤—ã–π API: `GET /tasks/:id/media`
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ `MediaDTO[]` –¥–ª—è –∑–∞–¥–∞—á–∏. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞ —á–µ—Ä–µ–∑ `authMiddleware`.

**–§–∞–π–ª**: –ù–æ–≤—ã–π —Ä–æ—É—Ç –≤ `src/api/routes/media.ts` –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ `files.ts`

#### 4. –ù–æ–≤—ã–π API: `POST /tasks/:id/media`
–ü—Ä–∏–Ω–∏–º–∞–µ—Ç `FormData` —Å –ø–æ–ª–µ–º `file`. –í–∞–ª–∏–¥–∞—Ü–∏—è:
- –†–∞–∑–º–µ—Ä ‚â§ 20MB
- –¢–∏–ø: image/*, application/pdf, application/*, text/* (whitelist)
- –ó–∞–¥–∞—á–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

–°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–∞–π–ª –Ω–∞ –¥–∏—Å–∫, —Å–æ–∑–¥–∞—ë—Ç `media` –∑–∞–ø–∏—Å—å, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `MediaDTO`.

**–§–∞–π–ª**: `src/api/routes/media.ts`

#### 5. –ù–æ–≤—ã–π API: `DELETE /media/:id`
–£–¥–∞–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –∏–∑ –ë–î + —Ñ–∞–π–ª —Å –¥–∏—Å–∫–∞. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞.

**–§–∞–π–ª**: `src/api/routes/media.ts`

#### 6. `mediaCount` –≤ TaskDTO
**–î–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞**:

| –í–∞—Ä–∏–∞–Ω—Ç | –ü–ª—é—Å—ã | –ú–∏–Ω—É—Å—ã |
|---------|-------|--------|
| SQL subquery `(SELECT COUNT(*) FROM media WHERE task_id = ?)` | –í—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ, –Ω–µ –Ω—É–∂–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è | –ß—É—Ç—å –¥–æ—Ä–æ–∂–µ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å |
| –î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–ª–æ–Ω–∫–∞ `media_count INTEGER DEFAULT 0` | –ë—ã—Å—Ç—Ä–æ —á–∏—Ç–∞—Ç—å | –ù–∞–¥–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å (–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç/–¥–µ–∫—Ä–µ–º–µ–Ω—Ç), –º–∏–≥—Ä–∞—Ü–∏—è |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: SQL subquery ‚Äî –ø—Ä–æ—â–µ, –Ω–∞–¥—ë–∂–Ω–µ–µ, –∏–Ω–¥–µ–∫—Å `idx_media_task` —É–∂–µ –µ—Å—Ç—å. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –û–ö –¥–ª—è –Ω–∞—à–∏—Ö –æ–±—ä—ë–º–æ–≤.

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

#### 1. –¢–∏–ø `Task` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å `mediaCount`
```typescript
// frontend/src/api/tasks.ts
export type Task = {
  // ... existing fields ...
  mediaCount: number;  // NEW
};
```

#### 2. –¢–∏–ø `Media` + —Ö—É–∫ `useTaskMedia`
```typescript
// frontend/src/api/media.ts (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)
export type Media = {
  id: string;
  taskId: string;
  type: 'photo' | 'document' | 'voice' | 'link';
  mimeType: string | null;
  originalFilename: string | null;
  transcription: string | null;
  transcriptionStatus: 'pending' | 'completed' | 'failed' | null;
  createdAt: number;
};

// React Query —Ö—É–∫–∏:
useTaskMedia(taskId)     // GET /tasks/:id/media
useUploadMedia(taskId)   // POST /tasks/:id/media (FormData)
useDeleteMedia()         // DELETE /media/:id
```

#### 3. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç `MediaAttachments` (–¥–ª—è TaskDetailSheet)
- –ó–∞–º–µ–Ω—è–µ—Ç –∑–∞–≥–ª—É—à–∫—É "–ú–µ–¥–∏–∞ –∏ —Ñ–∞–π–ª—ã –±—É–¥—É—Ç –∑–¥–µ—Å—å"
- –ï—Å–ª–∏ `mediaCount === 0` –∏ –Ω–µ—Ç `onUpload` ‚Üí —Å–∫—Ä—ã—Ç—å —Å–µ–∫—Ü–∏—é —Ü–µ–ª–∏–∫–æ–º
- –†–µ–Ω–¥–µ—Ä–∏—Ç:
  - **–§–æ—Ç–æ**: `<img>` –º–∏–Ω–∏–∞—Ç—é—Ä–∞, `src="/files/{mediaId}"`, –Ω–∞–∂–∞—Ç–∏–µ ‚Üí –ø–æ–ª–Ω—ã–π —Ä–∞–∑–º–µ—Ä
  - **–î–æ–∫—É–º–µ–Ω—Ç**: –∏–∫–æ–Ω–∫–∞ —Ñ–∞–π–ª–∞ + `originalFilename`, –Ω–∞–∂–∞—Ç–∏–µ ‚Üí —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
  - **–ì–æ–ª–æ—Å–æ–≤–æ–µ**: —Ç–µ–∫—Å—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ –∏–ª–∏ "–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞..."
- –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª" ‚Üí `<input type="file" accept="image/*,.pdf,.doc,.docx,.txt">`

#### 4. –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä üìé –≤ TaskRow –∏ SwipeCard
```tsx
{task.mediaCount > 0 && (
  <span className="inline-flex items-center gap-0.5 text-tg-hint">
    <span className="material-symbols-outlined text-sm">attach_file</span>
  </span>
)}
```

#### 5. –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ AddTaskSheet (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, Phase 2)
–ú–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–∑–∂–µ. –°–Ω–∞—á–∞–ª–∞ ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∑–∞–¥–∞—á—É —á–µ—Ä–µ–∑ TaskDetailSheet.

---

## Proxy: `frontend/dev.ts`
–ü—É—Ç—å `/files` —É–∂–µ –≤ proxy whitelist. –ï—Å–ª–∏ –¥–æ–±–∞–≤–ª—è–µ–º `/media` –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ä–æ—É—Ç, –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ `isBackendPath()`.

---

## –ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### Phase 1: –ë—ç–∫–µ–Ω–¥ (–º–æ–∂–Ω–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
1. –§–∏–∫—Å `saveFile()` ‚Äî `mediaId` –≤–º–µ—Å—Ç–æ `taskId`
2. –§–∏–∫—Å –∞–ª—å–±–æ–º–æ–≤ ‚Äî –≤—ã–∑–æ–≤ `processMediaMessage` –≤ —Ü–∏–∫–ª–µ
3. `mediaCount` —á–µ—Ä–µ–∑ SQL subquery –≤ `getTasks` / `getTask`
4. –ù–æ–≤—ã–µ API —Ä–æ—É—Ç—ã: GET/POST/DELETE media

### Phase 2: –§—Ä–æ–Ω—Ç–µ–Ω–¥ ‚Äî –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
5. –¢–∏–ø `Task.mediaCount`, —Ç–∏–ø `Media`
6. –•—É–∫ `useTaskMedia`
7. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç `MediaAttachments` –≤ TaskDetailSheet
8. –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä üìé –≤ TaskRow –∏ SwipeCard

### Phase 3: –§—Ä–æ–Ω—Ç–µ–Ω–¥ ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞
9. –•—É–∫ `useUploadMedia`
10. –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª" –≤ TaskDetailSheet
11. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ó–∞–≥—Ä—É–∑–∫–∞ –≤ AddTaskSheet

---

## –ù–µ –≤—Ö–æ–¥–∏—Ç –≤ MVP
- –í–∏–¥–µ–æ
- –ê—É–¥–∏–æ–ø–ª–µ–µ—Ä –¥–ª—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö
- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä PDF (—Ç–æ–ª—å–∫–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ)
- Drag & drop –∑–∞–≥—Ä—É–∑–∫–∞
- –°–∂–∞—Ç–∏–µ/—Ä–µ—Å–∞–π–∑ —Ñ–æ—Ç–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –∑–∞–≥—Ä—É–∑–∫–∏ (–ø—Ä–æ—Å—Ç–æ —Å–ø–∏–Ω–Ω–µ—Ä)
